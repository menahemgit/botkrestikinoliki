!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7a228752-0484-4211-9950-109bee753cba",e._sentryDebugIdIdentifier="sentry-dbid-7a228752-0484-4211-9950-109bee753cba")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9098],{25711:function(e,t,l){l.d(t,{D:function(){return c}});var n=l(53854),s=l(20981),a=l(89719),r=l(22571),i=l(85271),o=l(87442),u=l.n(o);let c=e=>{let{children:t,fetchNextPage:l,hasNextPage:o,showLoadingState:c,itemsToRender:d,loadingPlaceholder:m}=e,h=(0,s.useRef)(l);h.current=l;let x=(0,s.useRef)(u()(()=>h.current(),300)),v=(0,s.useRef)(null);(0,a.S)(v,x.current,{rootMargin:"50px",threshold:0});let f=m||(0==d.length?(0,n.jsx)(r.ZP,{className:"py-sm",children:(0,n.jsx)(i.default,{animateLines:!1,blockCount:12,divider:!0})}):(0,n.jsx)(r.ZP,{className:"py-md",children:(0,n.jsx)(i.default,{animateLines:!1,blockCount:1})}));return(0,n.jsxs)(n.Fragment,{children:[t,c&&f,d.length>0&&o&&(0,n.jsx)("div",{ref:v,className:"border border-transparent"})]})}},76585:function(e,t,l){l.d(t,{W:function(){return o}});var n=l(53854),s=l(64980),a=l(20981),r=l(92508),i=l(78113);let o=a.memo(e=>{let{icon:t,count:l,textVariant:a="tiny",textColor:o="light",className:u}=e;return(0,n.jsxs)("div",{className:"flex items-center gap-x-xs",children:[(0,n.jsx)(r.Z,{variant:a,color:o,className:u,children:(0,n.jsx)(s.G,{size:"sm",icon:t})}),(0,n.jsx)(r.Z,{variant:a,color:o,className:u,children:(0,i.uf)(l)})]})},(e,t)=>e.count===t.count&&e.icon===t.icon&&e.className===t.className)},16447:function(e,t,l){l.d(t,{j:function(){return u}});var n=l(53854),s=l(20981),a=l(76585),r=l(42066),i=l(9178),o=l(88121);let u=s.memo(e=>{var t,l;let{threadAccess:s,socialInfo:u,textVariant:c,textColor:d,className:m}=e;if(!s||!u||s<o.uv.PUBLIC_READ)return null;let h=null!==(t=u.view_count)&&void 0!==t?t:0,x=null!==(l=u.fork_count)&&void 0!==l?l:0;return(0,n.jsxs)(n.Fragment,{children:[h>0&&(0,n.jsx)(a.W,{icon:i.Md,count:h,textColor:d,textVariant:c,className:m}),x>0&&(0,n.jsx)(a.W,{icon:r.MD,count:x,textColor:d,textVariant:c,className:m})]})})},51404:function(e,t,l){var n=l(53854),s=l(20981),a=l(60359),r=l(56446),i=l(109),o=l(70154),u=l(57626),c=l(14180),d=l(40591),m=l(4009),h=l(45138),x=l(9618),v=l(93683);t.Z=e=>{let{show:t,isBookmarked:l,onDelete:f,onAddToCollection:g,onSwapCollection:p,onRemoveFromCollection:y,currentCollection:j,rwToken:w,type:C}=e,{isMobileStyle:b}=(0,m.d)(),N=!l&&(C===r.W.LIBRARY||C===r.W.SEARCH)&&null!=g,[k,I]=(0,s.useState)(!1),A=(0,a.useTranslations)("threadItem"),_=(0,a.useTranslations)("shared");if(!t)return null;let D=[{icon:o.faPlus,text:_("addToCollection"),show:N,onClick:g,testId:"thread-add-to-collection"},{icon:u.a_,text:_("swapCollections"),show:l&&null!=j&&null!=p,onClick:p,testId:"thread-swap-collection"},{icon:d.faXmark,text:_("removeFromCollection"),show:l&&null!=y&&null!=j,onClick:y,testId:"thread-remove-from-collection"},{icon:c.$,text:A("deleteThread"),show:null!==w&&null!=f,onClick:()=>I(!0),testId:"thread-delete"}];return(null==D?void 0:D.every(e=>!e.show))?null:(0,n.jsxs)("div",{children:[(0,n.jsx)(h.DropDownMenu,{items:D,isMobileStyle:b,children:(0,n.jsx)(x.Z,{testId:"thread-dropdown-menu",size:"small",icon:i.faEllipsis})}),(0,n.jsx)(v.Z,{isOpen:k,onClose:()=>I(!1),message:A("deleteThreadConfirmation"),actionList:[{text:_("nevermind"),onClick:()=>I(!1)},{text:_("confirm"),variant:"rejected",onClick:f}]})]})}},56446:function(e,t,l){l.d(t,{W:function(){return s},B:function(){return q}});var n,s,a=l(53854),r=l(20981),i=l(60359),o=l(53118),u=l(97825),c=l(35694),d=l(87159);let m=e=>{let{collections:t}=(0,d.l)();if(!e||!t)return null;let l=t.find(t=>t.uuid===e);return null!=l?l:null};var h=l(40980),x=l(77301),v=l(98510),f=l(32499),g=l(55752),p=l(21185),y=l(51404),j=l(90063),w=l(37462),C=l.n(w);let b=r.memo(e=>{let{type:t,featuredImage:l,title:n,className:r,href:i}=e;if(!l||t!==s.DISCOVER)return null;let u=(0,a.jsx)("div",{className:C()("relative h-24 w-24 flex-none overflow-hidden rounded-md",r),children:l.includes("images.unsplash.com")?(0,a.jsx)("img",{src:l,alt:n,className:"h-full w-full object-cover object-center"}):(0,a.jsx)(j.default,{src:l,alt:n,sizes:"33vw",fill:!0,priority:!0,className:"object-cover object-center"})});return i?(0,a.jsx)(o.default,{href:i,children:u}):u});var N=l(95500),k=l(60463),I=l(24307),A=l(92233),_=l(76585),D=l(16447),Z=l(43065);let S=(0,N.default)(()=>Promise.all([l.e(812),l.e(3562),l.e(9702),l.e(3101),l.e(9177),l.e(219),l.e(5240),l.e(7514),l.e(8320),l.e(4596),l.e(6420),l.e(125)]).then(l.bind(l,96420)).then(e=>e.TimeAgoTooltip),{loadableGenerated:{webpack:()=>[96420]},ssr:!1}),T=r.memo(e=>{let{threadCount:t,threadAccess:l,lastUpdated:n,socialInfo:s,focus:r}=e,i=(0,A.k)(),{locale:o}=(0,I.z)();return(0,a.jsxs)("div",{className:"flex items-center gap-x-md",children:[!!t&&t>1&&(0,a.jsx)(_.W,{icon:Z.i,count:t}),(0,a.jsx)(D.j,{socialInfo:s,threadAccess:l}),n&&(0,a.jsx)(S,{timestamp:n,translations:i,locale:o}),(0,a.jsx)(k.Z,{textColor:"light",textVariant:"tiny",focus:r})]})});var P=l(70154),Q=l(22571),U=l(92508),E=l(9618);let R=e=>{let{idx:t,title:l,preview:n,threadCount:j,lastUpdated:w,href:C="/",rwToken:N,focus:k,socialInfo:I,showActionMenu:A=!0,authorImage:_,threadAccess:D,type:Z,featuredImage:S,entryUUID:R,contextUUID:M,collection:O}=e,q=m(null==O?void 0:O.uuid),{openModal:z}=(0,v.useModalState)(),{collections:L}=(0,d.l)(),{searchTerm:W}=(0,f.p)(),{deleteThread:X}=(0,h.l)(),{removeThreadFromCollection:F}=(0,c.F)(),K=(0,u.useRouter)(),{trackEvent:B}=(0,x.WS)(),V=(0,i.useTranslations)("shared"),G=(0,r.useCallback)(e=>{let{entryUUID:t}=e;0===L.length?z("collectionCreateOrEdit",{existingCollection:q,frontendContextUUID:M,searchTerm:W}):z("collectionSelectModal",{entryUUID:t,userCollections:L,currentCollection:q,searchTerm:W})},[q,L,M,z,W]),H=(0,r.useCallback)(async e=>{X({entryUUID:e,collectionSlug:null==q?void 0:q.slug}),B("delete thread from history click",{entryUUID:e})},[null==q?void 0:q.slug,X,B]),Y=(0,r.useCallback)(()=>{Z===s.DISCOVER&&B("discover item click",{position:t,contextUUID:M})},[Z,B,t,M]);return(0,a.jsxs)(Q.ZP,{className:"flex items-center gap-x-md py-md md:px-0",onClick:Y,children:[(0,a.jsx)(b,{featuredImage:S,type:Z,title:l,href:C}),(0,a.jsxs)("div",{className:"w-full grow",children:[(0,a.jsx)(o.default,{href:C,className:"group block",children:(0,a.jsxs)(Q.ZP,{className:"",children:[(0,a.jsxs)("div",{className:"flex items-center gap-x-md",children:[(0,a.jsx)(U.Z,{className:"grow",variant:"baseSemi",children:(0,a.jsx)("div",{"data-testid":"thread-title",className:"line-clamp-1 break-all transition duration-300 md:group-hover:text-super md:dark:group-hover:text-superDark",children:l})}),null!=_&&(0,a.jsx)(p.Z,{size:"small",user:_})]}),(0,a.jsx)(U.Z,{color:"light",className:"break-word mt-two line-clamp-2 text-balance",children:n})]})}),(0,a.jsx)("div",{className:A?"mt-xs":"mt-sm",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(T,{threadCount:j,threadAccess:D,lastUpdated:w,socialInfo:I,focus:k}),(0,a.jsxs)("div",{className:"flex items-center gap-x-xs",children:[(null==O?void 0:O.title)&&Z===s.LIBRARY&&(0,a.jsx)(o.default,{href:"/collections/".concat(null==O?void 0:O.slug),className:"block",children:(0,a.jsx)(Q.ZP,{className:"rounded-full border px-xs",children:(0,a.jsxs)(U.Z,{variant:"tiny",className:"flex cursor-pointer select-none items-center gap-x-xs px-sm py-xs transition duration-300 hover:opacity-70",testId:"thread-collection-pill",children:[(0,a.jsx)(g.B,{unified:O.emoji,size:"tiny"}),(0,a.jsx)("div",{className:"line-clamp-1",children:O.title})]})})}),A&&!(null==O?void 0:O.title)&&(0,a.jsx)(E.Z,{testId:"add-to-collection",toolTip:V("addToCollection"),onClick:()=>G({entryUUID:R}),icon:P.faPlus,size:"small"}),(0,a.jsx)(y.Z,{show:A,isBookmarked:null!=q,onDelete:()=>H(R),onAddToCollection:()=>G({entryUUID:R}),onSwapCollection:()=>G({entryUUID:R}),onRemoveFromCollection:()=>F({entryUUID:R,oldCollectionUUID:null==q?void 0:q.uuid,callback:()=>{Z===s.COLLECTION&&K.push("/library")}}),currentCollection:q,rwToken:N,type:Z})]})]})})]})]})};var M=l(79032),O=l(25711);(n=s||(s={})).LIBRARY="library",n.COLLECTION="collection",n.DISCOVER="discover",n.SEARCH="search",n.INCOGNITO_SEARCH="incognitoSearch";let q=e=>{let{threads:t,fetchNextPage:l,hasNextPage:n=!1,showLoadingState:s=!1,showEmptyState:r=!1,type:o}=e,u=(null!=t?t:[]).map(M.gN),c=(0,i.useTranslations)("threads.main");return r&&0===u.length?(0,a.jsx)(Q.ZP,{variant:"offset",className:"mt-md flex items-center justify-center rounded p-xl",children:"collection"===o?(0,a.jsx)(U.Z,{color:"light",children:c("threadsPlaceholder")}):(0,a.jsx)(U.Z,{color:"light",children:c("noThreads")})}):(0,a.jsx)(O.D,{fetchNextPage:l,hasNextPage:n,showLoadingState:s,itemsToRender:u,children:(0,a.jsx)(Q.ZP,{className:"divide-y",children:u.map((e,t)=>{var l;return(0,a.jsx)(R,{idx:t,href:e.href,rwToken:e.rwToken,title:e.title,preview:e.preview,threadCount:e.threadCount,lastUpdated:e.lastUpdated,copilot:e.copilot,focus:e.focus,socialInfo:e.socialInfo,threadAccess:e.threadAccess,authorImage:e.authorImage,featuredImage:null!==(l=e.featuredImage)&&void 0!==l?l:null,showActionMenu:"discover"!==o,type:o,entryUUID:e.entryUUID,contextUUID:e.contextUUID,collection:e.collection},e.entryUUID)})})})}},60463:function(e,t,l){var n=l(53854),s=l(64980);l(20981);var a=l(94013),r=l(66795),i=l(22571),o=l(92508);t.Z=e=>{let{textVariant:t="baseSemi",textColor:l="default",focus:u}=e,{FocusConfigs:c}=(0,a.m)();return u&&u!==r.w.internet&&null!=c[u]?(0,n.jsx)(i.ZP,{children:(0,n.jsxs)(o.Z,{variant:t,color:l,className:"flex items-center gap-x-xs",children:[(0,n.jsx)(s.G,{size:"1x",icon:c[u].icon}),(0,n.jsx)("div",{children:c[u].text})]})}):null}},93740:function(e,t,l){var n=l(53854),s=l(46764),a=l(21062),r=l(20981),i=l(60359),o=l(21185),u=l(69032),c=l(4009),d=l(25245),m=l(2355),h=l(92508),x=l(22571),v=l(9618);t.Z=e=>{var t,l,f;let{showAvatar:g,showCreatorLabel:p,showEdit:y,isCurrentUser:j=!0,textColor:w,textVariant:C="smallBold",username:b,image:N,anon:k,avatarSize:I="small"}=e,{data:A,update:_}=(0,a.useSession)(),[D,Z]=r.useState(!1),[S,T]=r.useState(null!=b?b:j?null==A?void 0:null===(t=A.user)||void 0===t?void 0:t.username:"Anonymous"),[P,Q]=r.useState(),{isMobileUserAgent:U}=(0,c.d)(),E=(0,i.useTranslations)("settings.account"),R=async()=>fetch("/api/user",{method:"PUT",body:JSON.stringify({username:S})}),{mutate:M,isPending:O}=(0,s.useMutation)({mutationFn:R,onSuccess:e=>{e.json().then(t=>{if(200!==e.status){Q(t.message);return}Z(!1),Q(void 0),_()})}});return(0,r.useEffect)(()=>{var e;T(null!=b?b:j?null==A?void 0:null===(e=A.user)||void 0===e?void 0:e.username:"Anonymous")},[b,j,null==A?void 0:null===(l=A.user)||void 0===l?void 0:l.username]),(0,n.jsxs)("div",{className:"relative flex items-center gap-x-xs",children:[g&&(0,n.jsx)(o.Z,{size:I,anon:k,user:null!=N?N:j&&null!==(f=null==A?void 0:A.user.image)&&void 0!==f?f:void 0}),D?(0,n.jsx)("div",{children:(0,n.jsx)(d.ZP,{isMobileUserAgent:U,value:S,disabled:O,errorText:null!=P?P:""===S?"Username cannot be empty":"",onChange:e=>{T(e.target.value)},className:"md:min-w-[300px]",inlineEditBlock:A&&(0,n.jsxs)("div",{className:"ml-sm flex items-center gap-x-xs",children:[(0,n.jsx)(m.Z,{text:E("save"),variant:S===A.user.username||""===S||O?"common":"primary",size:"small",disabled:S===A.user.username||""===S||O,onClick:()=>M()}),(0,n.jsx)(m.Z,{text:E("cancel"),size:"small",disabled:O,onClick:()=>{T(A.user.username),Z(!1)}})]})})}):(0,n.jsx)(h.Z,{variant:C,color:w,className:"line-clamp-1 break-all",children:k?"Anonymous":S}),p&&(0,n.jsx)(x.ZP,{variant:"offset",className:"rounded-full px-sm py-xs",children:(0,n.jsx)(h.Z,{variant:"tiny",color:"light",children:"Author"})}),y&&!D&&(0,n.jsx)(v.Z,{pill:!0,size:"small",icon:u.faPenToSquare,onClick:()=>Z(!0)})]})}},87159:function(e,t,l){l.d(t,{l:function(){return r}});var n=l(70371),s=l(51577),a=l(93407);let r=()=>{var e;let t=(0,s.nO)(),l=async e=>{let{pageParam:l=0}=e;(!l||l<0)&&(l=1);let n=(l-1)*50;return await (null==t?void 0:t.emitWithAck("list_user_collections",{limit:50,offset:n}))},{data:r}=(0,n.useInfiniteQuery)({queryKey:a.X,enabled:!!t,initialPageParam:0,queryFn:e=>{let{pageParam:t}=e;return l({pageParam:t})},getNextPageParam:(e,t)=>{var l;return e&&(null===(l=e[0])||void 0===l?void 0:l.has_next_page)?t.length+1:void 0}});return{collections:null!==(e=null==r?void 0:r.pages[r.pages.length-1])&&void 0!==e?e:[]}}},40980:function(e,t,l){l.d(t,{l:function(){return m}});var n=l(74135),s=l(46764),a=l(56482),r=l(77732),i=l(51577),o=l(86096),u=l(32499),c=l(93407),d=l(42113);let m=()=>{let e=(0,n.useQueryClient)(),t=(0,i.nO)(),{searchTerm:l}=(0,u.p)(),{threadMetadata:m}=(0,o.a0)(),{clearSidebarRecentItems:h,removeItemFromSidebar:x}=(0,a.f)(),v=[d.T,{search_term:null!=l?l:""}],{mutate:f}=(0,s.useMutation)({mutationKey:["removeWidget"],mutationFn:e=>{let{entryUUID:t,data:l}=e;return(0,r.UF)(t,l.url,m.rwToken)},onMutate:async t=>{let{entryUUID:l,data:n,frontendContextUUID:s}=t;await e.cancelQueries({queryKey:["results"]}),e.setQueryData(["results"],e=>({...e,[s]:e[s].map(e=>{if(e.backend_uuid===l){var t,s;n.is_widget&&(e.widget_data=null===(t=e.widget_data)||void 0===t?void 0:t.filter(e=>e.url!==n.url)),n.is_knowledge_card&&(e.knowledge_cards=null===(s=e.knowledge_cards)||void 0===s?void 0:s.filter(e=>e.url!==n.url))}return e})}))}}),{mutate:g}=(0,s.useMutation)({mutationFn:async()=>{if(!t)throw Error("No socket connection");await t.emitWithAck("delete_all_threads")},onMutate:async()=>{h(),await e.cancelQueries({queryKey:v}),await e.cancelQueries({queryKey:c.X});let t=e.getQueryData(v),l=e.getQueryData(c.X);return e.setQueryData(c.X,e=>{let t=e.pages.map(e=>e.map(e=>({...e,thread_count:0})));return{...e,pages:t}}),e.setQueryData(v,e=>({...e,pages:[]})),{previousThreads:t,previousCollections:l}},onSettled:(t,l,n,s)=>{l?(e.setQueryData(v,s.previousThreads),e.setQueryData(c.X,s.previousCollections)):(e.invalidateQueries({queryKey:v}),e.invalidateQueries({queryKey:c.X}))}}),{mutate:p}=(0,s.useMutation)({mutationFn:async e=>{let{entryUUID:l,callback:n}=e;if(!t)throw Error("No socket connection");null==n||n(),await t.emitWithAck("delete_thread_by_entry_uuid",l,{read_write_token:null==m?void 0:m.rwToken}),x(l)},onMutate:async t=>{let{entryUUID:l,collectionSlug:n}=t;await e.cancelQueries({queryKey:v}),await e.cancelQueries({queryKey:c.X});let s=e.getQueryData(v),a=e.getQueryData(c.X);return e.setQueryData(v,e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.filter(e=>e.uuid!==l));return{...e,pages:t}}),n&&(e.setQueryData(c.X,e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.map(e=>e.slug===n?{...e,thread_count:e.thread_count-1}:e));return{...e,pages:t}}),e.setQueryData(["list_collection_threads",{collection_slug:n.slice(-22)}],e=>{let t=(e=e||{pages:[],pageParams:[]}).pages.map(e=>e.filter(e=>e.uuid!==l));return{...e,pages:t}})),{previousThreads:s,previousCollections:a}},onSettled:(t,l,n,s)=>{l?(e.setQueryData(v,s.previousThreads),e.setQueryData(c.X,s.previousCollections)):(e.invalidateQueries({queryKey:v}),e.invalidateQueries({queryKey:c.X}))}});return{removeWidgetFromEntry:f,deleteAllThreads:g,deleteThread:p}}},89719:function(e,t,l){l.d(t,{S:function(){return s}});var n=l(20981);let s=(e,t,l)=>{(0,n.useEffect)(()=>{let n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&t()})},l),s=e.current;return s&&n.observe(s),()=>{s&&n.unobserve(s)}},[e,t,l])}},92233:function(e,t,l){l.d(t,{k:function(){return s}});var n=l(60359);let s=()=>{let e=(0,n.useTranslations)("shared");return{yearAgo:e("yearAgo"),yearsAgo:e("yearsAgo"),monthAgo:e("monthAgo"),monthsAgo:e("monthsAgo"),dayAgo:e("dayAgo"),daysAgo:e("daysAgo"),hourAgo:e("hourAgo"),hoursAgo:e("hoursAgo"),minutesAgo:e("minutesAgo"),minuteAgo:e("minuteAgo"),justNow:e("justNow"),justNowShort:e("justNowShort")}}},93683:function(e,t,l){var n=l(53854);l(20981);var s=l(92508),a=l(69192);t.Z=e=>{let{message:t,...l}=e;return(0,n.jsx)(a.Z,{title:void 0,subtitle:void 0,...l,children:(0,n.jsx)(s.Z,{variant:"section-title",className:"pb-md text-center",children:t})})}}}]);