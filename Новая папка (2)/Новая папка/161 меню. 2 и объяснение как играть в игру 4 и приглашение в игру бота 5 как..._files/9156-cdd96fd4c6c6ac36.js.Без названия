!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="29ea5ef7-e3b6-40d8-ad48-9859f87eab99",e._sentryDebugIdIdentifier="sentry-dbid-29ea5ef7-e3b6-40d8-ad48-9859f87eab99")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9156],{2998:function(e,t,n){n.d(t,{M:function(){return h}});var i=n(53854),r=n(64980),a=n(20981),o=n(60359),u=n(3412),l=n(66447),c=n(26781),s=n(67144),d=n(2395),_=n(92508),m=n(91579),f=n(9618),y=n(2355);let h=e=>{let{searchValue:t,setSearchValue:n,onSearchSubmit:h,onSearchClear:g,isLoading:p,placeholder:v}=e,[w,x]=(0,a.useState)(!1),k=(0,o.useTranslations)("article.mediaSheet"),M=(0,a.useCallback)(e=>{n(e.target.value),x(!1)},[n,x]),S=(0,a.useCallback)(()=>{g(),x(!1)},[g,x]),b=(0,a.useCallback)(()=>{h(),x(!0)},[h,x]);return(0,i.jsxs)(d.G,{size:"default",wrapperClass:"pl-md",children:[(0,i.jsx)(d.G.LeftAttribution,{children:(0,i.jsx)(_.Z,{color:"light",className:"mt-[1px]",children:(0,i.jsx)(r.G,{icon:c.faMagnifyingGlass,size:"sm"})})}),(0,i.jsx)(d.G.Input,{placeholder:null!=v?v:k("searchForMedia"),isMobileStyle:!1,isMobileUserAgent:!1,value:t,onChange:M,onKeyDown:e=>{s.t.isEnterKeyWithoutShift(e)&&b()}}),(0,i.jsx)(d.G.RightAttribution,{children:p?(0,i.jsx)("div",{className:"mr-xs flex h-[32px] w-[32px] items-center justify-center",children:(0,i.jsx)(m.$,{})}):w?(0,i.jsx)(f.Z,{icon:l.YI,size:"small",pill:!0,extraCSS:"mr-xs",onClick:S}):(0,i.jsx)(y.Z,{icon:u.eF,size:"small",pill:!0,extraCSS:"mr-xs",onClick:b,variant:"primary",disabled:""===t})})]})}},21129:function(e,t,n){n.r(t),n.d(t,{ArticleResultsProvider:function(){return g},useArticleResults:function(){return p}});var i=n(53854),r=n(74135),a=n(42138),o=n(9358),u=n(20981),l=n(97825),c=n(93895),s=n(86096),d=n(88121),_=n(78113),m=n(6503);let f=e=>{var t,n,i,r;return e.length>0&&e[0].article_info?{title:e[0].article_info.title||"",suggested_sections:(null===(t=e[0].article_info)||void 0===t?void 0:t.suggested_sections)||[],audience:(null===(n=e[0].article_info)||void 0===n?void 0:n.audience)||"anyone",read_time:e[0].article_info.read_time,emphasize_sources:null!==(i=e[0].article_info.emphasize_sources)&&void 0!==i&&i,num_sections:e.length,should_index:null!==(r=e[0].should_index)&&void 0!==r&&r}:null},y={article:[],heroSection:void 0,isLoading:!1,inFlight:!1,inFlightLatest:!1,currentlyStreamingSection:void 0,socialStats:{forkCount:0,likeCount:0,viewCount:0,userLikes:!1},threadMetadata:{rwToken:void 0,contextUUID:void 0,frontendContextUUID:void 0,title:void 0,first_query:void 0,focus:void 0,author_id:void 0,author_username:void 0,author_image:void 0,parent_info:void 0,mode:void 0,personalized:!1,collection:void 0,thread_access:0,thread_url_slug:void 0,updated_datetime:void 0,expiry_time:void 0,privacy_state:d.Jr.NONE},articleMetadata:{title:void 0,suggested_sections:[],audience:"anyone",read_time:0,emphasize_sources:!1,num_sections:0,should_index:!1},articleMedia:[],articleWebResults:[],articleLocalState:{isEditModeEnabled:!1,setEditModeEnabled:()=>void 0,isCreating:!1,setIsCreating:()=>void 0,isTitleVisible:!0,setTitleVisible:()=>void 0,clickedImage:null,setClickedImage:()=>void 0,clickedImageIndex:0,isRewritingSection:!1,setRewritingSection:()=>void 0},refetch:()=>void 0},h=(0,u.createContext)(y),g=e=>{var t,n;let{children:d}=e,[y,g]=(0,u.useState)(!1),[p,v]=(0,u.useState)(!1),[w,x]=(0,u.useState)(null),[k,M]=(0,u.useState)(!0),[S,b]=(0,u.useState)(!1),U=(0,r.useQueryClient)(),R=(0,l.useSearchParams)(),I=null==R?void 0:R.get("newFrontendContextUUID"),D=(0,l.usePathname)(),T=null==D?void 0:D.split("/").pop(),[C,F]=(0,u.useState)(U.getQueryData(["article-slug",T]));(0,u.useEffect)(()=>{I&&F(I)},[I,U,T]);let A=(0,u.useCallback)(async(e,t)=>{let{queryKey:n}=e,[,{frontend_context_uuid:i}]=n;return i?U.getQueryData(["articleResults",{frontend_context_uuid:i}])||(m.Tb("[ArticleResultsProvider]: no data in cache for frontend_context_uuid: ".concat(i)),[]):await (0,c.NM)(t)},[U]),{data:P}=(0,a.useQuery)({queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),refetchOnMount:!0,placeholderData:o.Wk,select:e=>({inFlight:e.some(e=>"pending"===e.status),inFlightLatest:e.length>0&&"pending"===e[e.length-1].status})}),E=null!==(t=null==P?void 0:P.inFlight)&&void 0!==t&&t,Q=null!==(n=null==P?void 0:P.inFlightLatest)&&void 0!==n&&n,{data:j}=(0,a.useQuery)({queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),refetchOnMount:!0,placeholderData:o.Wk,select:e=>e.find(e=>"pending"===e.status&&e.backend_uuid)}),{data:K,isLoading:L}=(0,a.useQuery)({enabled:!!T,queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),refetchOnMount:!0,placeholderData:o.Wk}),{data:O}=(0,a.useQuery)({queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),refetchOnMount:!0,placeholderData:o.Wk,select:e=>{var t;if(!e||0===e.length||"pending"===e[0].status)return null;let n=null===(t=e[0])||void 0===t?void 0:t.social_info;return n||(0,s.OR)(s.Dv),(0,s.OR)(n)}}),{data:q}=(0,a.useQuery)({queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),placeholderData:o.Wk,refetchOnMount:!0,select:s.BX}),{data:N}=(0,a.useQuery)({queryKey:["articleResults",{frontend_context_uuid:C}],queryFn:e=>A(e,T),placeholderData:o.Wk,refetchOnMount:!0,select:f}),X=(0,u.useMemo)(()=>{let e=[];return null==K||K.forEach(t=>{var n,i;if("media-only"===t.article_info.layout){let i=null!==(n=t.article_info.user_selected_media_items)&&void 0!==n?n:[],r=null==i?void 0:i.filter(e=>"image"===e.medium);e.push(...r)}else{let n=null!==(i=null==t?void 0:t.media_items)&&void 0!==i?i:[];n.length>0&&"text"!=t.article_info.layout&&"image"===n[0].medium&&e.push(n[0])}}),e},[K]),z=(0,u.useMemo)(()=>{if(!w)return 0;let e=X.findIndex(e=>(null==e?void 0:e.image)===(null==w?void 0:w.image));return e>-1?e:0},[w,X]),H=(0,u.useMemo)(()=>{let e=new Map;return K&&0!==K.length?(null==K||K.forEach(t=>{let n=(0,_.EH)(t);(null==n?void 0:n.web_results)&&n.web_results.forEach(t=>{e.has(t.url)?e.get(t.url).count+=1:e.set(t.url,{...t,count:1})})}),Array.from(e.values()).sort((e,t)=>t.count-e.count).map(e=>({...e,count:void 0}))):[]},[K]);return(0,i.jsx)(h.Provider,{value:{article:null!=K?K:[],isLoading:L,heroSection:null==K?void 0:K[0],lastSection:null==K?void 0:K[K.length-1],socialStats:O,inFlight:E,inFlightLatest:Q,currentlyStreamingSection:j,threadMetadata:null!=q?q:(0,s.BX)([]),articleMetadata:null!=N?N:f([]),articleLocalState:{isEditModeEnabled:y,setEditModeEnabled:g,isTitleVisible:k,setTitleVisible:M,isCreating:p,setIsCreating:v,clickedImage:w,setClickedImage:x,clickedImageIndex:z,isRewritingSection:S,setRewritingSection:b},articleMedia:X,articleWebResults:H},children:d})},p=()=>{let e=(0,u.useContext)(h);if(!e)throw Error("useArticleResults must be used within ArticleResultsContext");return e}},89e3:function(e,t,n){n.d(t,{Z:function(){return p}});var i=n(74135),r=n(46764),a=n(20981),o=n(2889),u=n(77301),l=n(56482),c=n(77732),s=n(51577),d=n(98510),_=n(72107),m=n(21129),f=n(63292);let y=f.z.object({url:f.z.string().optional(),fields:f.z.record(f.z.union([f.z.string(),f.z.number()])).optional(),success:f.z.boolean().optional(),status:f.z.string(),rate_limited:f.z.boolean().optional()});var h=n(68953),g=n(88121);let p=()=>{let{threadMetadata:e,lastSection:t}=(0,m.useArticleResults)(),{openModal:n}=(0,d.useModalState)(),{decrementCreateLimit:f}=(0,_.h)(),p=(0,s.nO)(),v=(0,i.useQueryClient)(),w=(0,o.O)(),{removeItemFromSidebar:x}=(0,l.f)(),{trackEvent:k}=(0,u.WS)(),{mutate:M}=(0,r.useMutation)({mutationKey:["updateArticleSectionTitle",e.thread_url_slug],mutationFn:t=>{let{title:n,backendUUID:i}=t;return(0,c.TF)(i,n,e.rwToken)},onMutate:async e=>{let{title:n,backendUUID:i}=e;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],e=>e.map(e=>e.backend_uuid===i?{...e,article_info:{...e.article_info,title:n,has_changed_title:!0}}:e))}}),{mutate:S}=(0,r.useMutation)({mutationKey:["updateArticleSectionHeroOffset",e.thread_url_slug],mutationFn:async t=>{let{backendUUID:n,callback:i,heroOffset:r}=t,a=await (0,c.mq)(n,r,e.rwToken);return i(),a},onMutate:async e=>{let{frontendContextUUID:t,backendUUID:n,heroOffset:i}=e;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:t}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:t}],e=>e.map(e=>e.backend_uuid===n?{...e,article_info:{...e.article_info,hero_offset:i}}:e))}}),{mutate:b}=(0,r.useMutation)({mutationKey:["publishArticleMutation",e.thread_url_slug],mutationFn:async t=>{let{callback:n}=t;return n(),k("change page access level",{contextUUID:e.contextUUID,oldAccessLevel:g.uv.PRIVATE_READ,newAccessLevel:g.uv.PUBLIC_READ}),w(e.contextUUID,g.uv.PUBLIC_READ,e.rwToken)},onMutate:async()=>{await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(!e)return;let[t,...n]=e;return[{...t,thread_access:g.uv.PUBLIC_READ},...n]})}}),{mutate:U}=(0,r.useMutation)({mutationKey:["unpublishArticleMutation",e.thread_url_slug],mutationFn:async()=>(k("change page access level",{contextUUID:e.contextUUID,oldAccessLevel:g.uv.PUBLIC_READ,newAccessLevel:g.uv.PRIVATE_READ}),w(e.contextUUID,g.uv.PRIVATE_READ,e.rwToken)),onMutate:async()=>{await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(!e)return;let[t,...n]=e;return[{...t,thread_access:g.uv.PRIVATE_READ},...n]})}}),R=(0,a.useCallback)(async t=>{let{backendUUID:n}=t;if(!p){console.error("Socket is null");return}let{status:i,media_items:r}=await p.emitWithAck("search_images_for_entry",n,{read_write_token:null==e?void 0:e.rwToken});"failed"!==i&&n&&v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(e)return e.map(e=>e.backend_uuid===n?{...e,media_items:r}:e)})},[v,p,e.frontendContextUUID,null==e?void 0:e.rwToken]),I=(0,a.useCallback)(async t=>{let{backendUUID:i,imageStyle:r,customInstructions:a=null,onFailureCallback:o}=t;if(!p){console.error("Socket is null");return}let{status:u,error_code:l,media_items:c}=await p.emitWithAck("create_image_for_entry",i,{image_style:r,custom_instructions:a,read_write_token:null==e?void 0:e.rwToken});"failed"===u?"PRO_ONLY"===l?n("pricingModal",{redirectUrl:"",pitchMessage:{title:"Generate DALL-E images with Pro",description:"Upgrade to Pro to generate DALL-E images"},origin:g.FM.GENERATE_IMAGE}):o("MODERATION"===l?"Failed due to moderation. Please try a different query":"Something is wrong with image generation. Please try later."):i&&(v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(e)return e.map(e=>e.backend_uuid===i?{...e,media_items:c}:e)}),f())},[f,n,v,p,e.frontendContextUUID,null==e?void 0:e.rwToken]),{mutate:D}=(0,r.useMutation)({mutationKey:["deleteArticle",e.thread_url_slug],mutationFn:async t=>{let{sectionUUID:n,callback:i}=t;if(!p)throw Error("No socket connection");null==i||i(),await p.emitWithAck("delete_thread_by_entry_uuid",n,{read_write_token:null==e?void 0:e.rwToken}),x(n)}}),{mutate:T}=(0,r.useMutation)({mutationKey:["deleteSection",e.thread_url_slug],mutationFn:t=>(0,c.J1)(t,e.rwToken),onMutate:async e=>{await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],t=>t.filter(t=>t.backend_uuid!==e))}}),{mutate:C}=(0,r.useMutation)({mutationKey:["updateArticleSectionsLayout",e.thread_url_slug],mutationFn:async t=>{let{sections:n}=t;return await (0,c.l8)(n,e.rwToken)},onMutate:async e=>{let{sections:n}=e;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],e=>e.map(e=>{let t=n.find(t=>t.sectionUUID===e.backend_uuid);return t?{...e,article_info:{...e.article_info,layout:t.layout}}:e}))}}),{mutate:F}=(0,r.useMutation)({mutationKey:["updateArticleSectionImage",e.thread_url_slug],mutationFn:t=>{let{backendUUID:n,mediaItem:i,targetIndex:r,isNewMediaItem:a}=t;return(0,c.fz)({sectionUUID:n,mediaItem:i,targetIndex:r,isNewMediaItem:a,rwToken:e.rwToken})},onMutate:async n=>{let{backendUUID:i,mediaItem:r,targetIndex:a,isNewMediaItem:o}=n;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),o&&v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>e.map(e=>e.backend_uuid===i?{...e,media_items:[r,...e.media_items||[]]}:e)),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(e)return e.map(e=>{if(e.backend_uuid!==i)return e;if("media-only"===e.article_info.layout&&e.media_items&&r.image){let t=(0,h.ud)(e.article_info.user_selected_media_items,e.media_items,r.image,a);return{...e,article_info:{...e.article_info,user_selected_media_items:t}}}if(e.media_items&&r.image){let t=(0,h.Hk)(e.media_items,r.image,a);return{...e,media_items:t}}})})}}),{mutate:A}=(0,r.useMutation)({mutationKey:["addMediaItemToSectionSelectedImages",e.thread_url_slug],mutationFn:t=>{let{sectionUUID:n,mediaItem:i,isNewMediaItem:r}=t;return(0,c.AM)(n,i,e.rwToken,r)},onMutate:async n=>{let{sectionUUID:i,mediaItem:r,isNewMediaItem:a}=n;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>e?a?e.map(e=>e.backend_uuid===i?{...e,media_items:[r,...e.media_items||[]],article_info:{...e.article_info,user_selected_media_items:[...e.article_info.user_selected_media_items,r]}}:e):e.map(e=>{if(e.backend_uuid===i){var t;return{...e,article_info:{...e.article_info,user_selected_media_items:[...e.article_info.user_selected_media_items,null===(t=e.media_items)||void 0===t?void 0:t.find(e=>e.image===r.image)]}}}return e}):void 0)}}),{mutate:P}=(0,r.useMutation)({mutationKey:["removeMediaItemFromSectionSelectedImages",e.thread_url_slug],mutationFn:t=>{let{sectionUUID:n,mediaItemImageUrl:i}=t;return(0,c.Th)(n,i,e.rwToken)},onMutate:async n=>{let{sectionUUID:i,mediaItemImageUrl:r}=n;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(e)return e.map(e=>e.backend_uuid===i?{...e,article_info:{...e.article_info,user_selected_media_items:e.article_info.user_selected_media_items.filter(e=>e.image!==r)}}:e)})}}),{mutate:E}=(0,r.useMutation)({mutationKey:["uploadImageToSectionMediaItems",e.thread_url_slug],mutationFn:async t=>{let{sectionUUID:n,image:i,onSuccessCallback:r,onFailureCallback:a}=t,o=await (0,c.jX)(n,i,e.rwToken),u=y.parse(o);if("failed"===u.status){a("Something went wrong. Please try later.");return}let l=new FormData;Object.entries(u.fields||{}).forEach(e=>{let[t,n]=e;l.append(t,n.toString())}),l.append("file",i);try{let e=await fetch(u.url||"",{method:"POST",body:l});if(e.ok){var s,d;let t=await e.json();if((null==t?void 0:null===(d=t.moderation)||void 0===d?void 0:null===(s=d[0])||void 0===s?void 0:s.status)==="rejected"){a("Failed due to moderation. Please try a different image"),r();return}let i=null==t?void 0:t.secure_url,o={image:i,url:i,source:i,medium:"image",thumbnail:i,image_width:null==t?void 0:t.width,image_height:null==t?void 0:t.height};r(),O({sectionUUID:n,mediaItem:o})}else a("Something went wrong. Please try later.")}catch(e){a("Something went wrong. Please try later.")}}}),{mutate:Q}=(0,r.useMutation)({mutationKey:["reorderArticleSection",e.thread_url_slug],mutationFn:t=>{let{sectionUUID:n,relativeMove:i}=t;return(0,c.M6)(e.thread_url_slug,n,i,e.rwToken)},onMutate:async n=>{let{sectionUUID:i,relativeMove:r}=n;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>{if(!e)return;let t=e.findIndex(e=>e.backend_uuid===i);if(-1===t)return console.error("Section not found"),e;let n=t+r;if(n<0||n>=e.length)return console.error("Invalid move"),e;let a=[...e],o=a[t];return a[t]=a[n],a[n]=o,a})}}),{mutate:j}=(0,r.useMutation)({mutationKey:["searchMediaForQuery",e.thread_url_slug],mutationFn:async t=>{let{query:n,sectionUUID:i,onSuccessCallback:r}=t;if(!p)throw Error("No socket connection");let{status:a,media_items:o}=await p.emitWithAck("search_images_and_videos",n,{read_write_token:null==e?void 0:e.rwToken,entry_uuid:i});"failed"!==a&&r(o)}}),{mutate:K}=(0,r.useMutation)({mutationKey:["searchShoppingForQuery",e.thread_url_slug],mutationFn:async t=>{let{query:n,sectionUUID:i,onSuccessCallback:r}=t;if(!p)throw Error("No socket connection");let{status:a,shopping_widgets:o}=await p.emitWithAck("search_shopping_for_entry",n,{read_write_token:null==e?void 0:e.rwToken,entry_uuid:i});"failed"!==a&&r(o)}}),{mutate:L}=(0,r.useMutation)({mutationKey:["generateReviewSummaryForItem",e.thread_url_slug],mutationFn:async t=>{let{webResult:n,sectionUUID:i,onSuccessCallback:r}=t;if(!p)throw Error("No socket connection");let{status:a,search_result_with_review_summary:o}=await p.emitWithAck("generate_review_summary_for_item",n,{read_write_token:null==e?void 0:e.rwToken,entry_uuid:i});"failed"!==a&&r(o)},onMutate:async t=>{let{webResult:n,sectionUUID:i}=t;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>e.map(e=>e.backend_uuid===i?{...e,widget_data:[n,...e.widget_data||[]]}:e))}}),{mutate:O}=(0,r.useMutation)({mutationKey:["addMediaItemToSection",e.thread_url_slug],mutationFn:t=>{let{sectionUUID:n,mediaItem:i}=t;return(0,c.vE)(n,i,e.rwToken)},onMutate:async t=>{let{sectionUUID:n,mediaItem:i}=t;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>e.map(e=>e.backend_uuid===n?{...e,media_items:[i,...e.media_items||[]]}:e))}}),{mutate:q}=(0,r.useMutation)({mutationKey:["removeWidget",e.thread_url_slug],mutationFn:t=>{let{sectionUUID:n,urlToRemove:i}=t;return(0,c.UF)(n,i,e.rwToken)},onMutate:async t=>{let{sectionUUID:n,urlToRemove:i}=t;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:e.frontendContextUUID}],e=>e.map(e=>{if(e.backend_uuid===n){var t,r;return{...e,widget_data:null===(t=e.widget_data)||void 0===t?void 0:t.filter(e=>e.url!==i),knowledge_cards:null===(r=e.knowledge_cards)||void 0===r?void 0:r.filter(e=>e.url!==i)}}return e}))},onSettled:()=>{v.invalidateQueries({queryKey:["articleResults",{frontend_context_uuid:e.frontendContextUUID}]})}}),{mutate:N}=(0,r.useMutation)({mutationKey:["toggleEmphasizeSources",e.thread_url_slug],mutationFn:async t=>{let{sectionUUID:n,value:i}=t;return await (0,c.tq)(n,e.rwToken,i)},onMutate:async e=>{let{sectionUUID:n,value:i}=e;await v.cancelQueries({queryKey:["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],exact:!1}),v.setQueryData(["articleResults",{frontend_context_uuid:null==t?void 0:t.frontend_context_uuid}],e=>e.map(t=>e.find(e=>e.backend_uuid===n)?{...t,article_info:{...t.article_info,emphasize_sources:i}}:t))}});return{updateArticleSectionTitle:M,updateArticleSectionHeroOffset:S,publishArticleMutation:b,unpublishArticleMutation:U,searchArticleSectionImages:R,generateArticleSectionImage:I,deleteArticle:D,deleteArticleSection:T,updateArticleSectionsLayout:C,updateArticleSectionImage:F,addMediaItemToSectionSelectedImages:A,removeMediaItemFromSectionSelectedImages:P,uploadImageToSectionMediaItems:E,reorderArticleSection:Q,searchMediaForQuery:j,searchShoppingForQuery:K,generateReviewSummaryForItem:L,addMediaItemToSection:O,removeWidget:q,toggleEmphasizeSources:N}}},2889:function(e,t,n){n.d(t,{O:function(){return a}});var i=n(20981),r=n(51577);function a(){let e=(0,r.nO)(),[t,n]=(0,i.useState)(!1);return(0,i.useCallback)((i,r,a,o)=>{e&&!t&&(n(!0),e.emit("update_thread_access",i,r,{read_write_token:a},e=>{n(!1),(null==e?void 0:e.access)!=null&&(null==o||o(null==e?void 0:e.access))}))},[t,e])}},56482:function(e,t,n){n.d(t,{G:function(){return l},f:function(){return d}});var i=n(74135),r=n(42138),a=n(20981),o=n(54194),u=n(97455);let l=8,c="recentItems",s=()=>{let e=localStorage.getItem(c);return e?JSON.parse(e):[]},d=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=(0,u.f)(),n=(0,i.useQueryClient)(),{isIncognito:d}=(0,o.useLocalUserSettings)(),_=(0,r.useQuery)({queryKey:[c],queryFn:s,enabled:e}),m=(0,a.useCallback)(e=>{d||n.setQueryData([c],function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=new URL(e.permalink,"http://example.com"),i={...e,permalink:n.pathname},r=[i,...t.filter(t=>t.id!==e.id&&t.permalink!==i.permalink)].slice(0,l);return localStorage.setItem(c,JSON.stringify(r)),r})},[n,d]),f=(0,a.useCallback)(e=>{n.setQueryData([c],function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t)return;let i=n.filter(t=>t.id!==e&&!t.permalink.endsWith(e));return localStorage.setItem(c,JSON.stringify(i)),i})},[t,n]),y=(0,a.useCallback)(()=>{n.setQueryData([c],[]),localStorage.removeItem(c)},[n]);return{..._,addItemToSidebar:m,removeItemFromSidebar:f,clearSidebarRecentItems:y}}},77732:function(e,t,n){n.d(t,{AM:function(){return s},G$:function(){return p},J1:function(){return u},M6:function(){return m},TF:function(){return a},Th:function(){return _},UF:function(){return h},eS:function(){return f},fz:function(){return c},jX:function(){return d},l8:function(){return l},mq:function(){return o},o_:function(){return r},tq:function(){return g},vE:function(){return y}});var i=n(54510);let r=async(e,t,n)=>{let r="sendUserFeedback";try{let a=await (0,i.$e)({urlPath:"rest/entry/feedback/".concat(e),timeoutMs:(0,i.vX)(),method:"POST",body:JSON.stringify({label:t,feedback:n}),headers:{"Content-Type":"application/json"}});return(0,i.HL)(r),a.json()}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},a=async(e,t,n)=>{let r="updateArticleSectionTitle";if(n)try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/section/title/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:n,title:t}),headers:{"Content-Type":"application/json"},numRetries:1});return(0,i.HL)(r),a.json()}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},o=async(e,t,n)=>{let r="updateArticleSectionHeroOffset";if(n)try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/section/hero_offset/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:n,hero_offset:t}),headers:{"Content-Type":"application/json"},numRetries:1});return(0,i.HL)(r),a.json()}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},u=async(e,t)=>{let n="deleteArticleSection";if(e&&t)try{let r=await (0,i.FX)({urlPath:"p/api/v1/article/section/".concat(e),timeoutMs:(0,i.vX)(),method:"DELETE",body:JSON.stringify({read_write_token:t}),headers:{"Content-Type":"application/json"},numRetries:1}),a=await r.json();return(0,i.HL)(n),a}catch(e){throw(0,i.i8)(n,e),console.error("".concat(n," error:"),e),e}},l=async(e,t)=>{let n="updateArticleSectionsLayout";if(t&&0!==e.length)try{let r=await (0,i.FX)({urlPath:"p/api/v1/article/sections/layout",timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:t,sections:e}),headers:{"Content-Type":"application/json"},numRetries:1}),a=await r.json();return(0,i.HL)(n),a}catch(e){throw(0,i.i8)(n,e),console.error("".concat(n," error:"),e),e}},c=async e=>{let{sectionUUID:t,mediaItem:n,targetIndex:r,rwToken:a,isNewMediaItem:o=!1}=e,u="updateArticleSectionImage";if(a)try{let e=await (0,i.FX)({urlPath:"p/api/v1/article/section/image/".concat(t),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:a,media_item:n,target_index:r,new_media_item:o}),headers:{"Content-Type":"application/json"},numRetries:1}),l=await e.json();return(0,i.HL)(u),l}catch(e){throw(0,i.i8)(u,e),console.error("".concat(u," error:"),e),e}},s=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="addMediaItemToSectionSelectedImagesMutation";if(n)try{let o=await (0,i.FX)({urlPath:"p/api/v1/article/section/media/add/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:n,media_item:t,new_media_item:r}),headers:{"Content-Type":"application/json"},numRetries:1}),u=await o.json();return(0,i.HL)(a),u}catch(e){throw(0,i.i8)(a,e),console.error("".concat(a," error:"),e),e}},d=async(e,t,n)=>{let r="uploadImageToSectionMediaItemsMutation";if(n)try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/section/upload_image/".concat(e),timeoutMs:(0,i.vX)(),method:"POST",body:JSON.stringify({read_write_token:n,content_type:t.type}),headers:{"Content-Type":"application/json"},numRetries:1}),o=await a.json();return(0,i.HL)(r),o}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},_=async(e,t,n)=>{let r="addMediaItemToSectionSelectedImagesMutation";if(n)try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/section/media/remove/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:n,media_item_image_url:t}),headers:{"Content-Type":"application/json"},numRetries:1}),o=await a.json();return(0,i.HL)(r),o}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},m=async(e,t,n,r)=>{let a="reorderArticleSectionMutation";if(r)try{let o=await (0,i.FX)({urlPath:"p/api/v1/article/reorder/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:r,section_uuid:t,relative_move:n}),headers:{"Content-Type":"application/json"},numRetries:1}),u=await o.json();return(0,i.HL)(a),u}catch(e){throw(0,i.i8)(a,e),console.error("".concat(a," error:"),e),e}},f=async e=>{let t="terminateArticleSectionStreaming";if(e)try{let n=await (0,i.FX)({urlPath:"p/api/v1/article/section/terminate/".concat(e),timeoutMs:(0,i.vX)(),method:"POST",numRetries:1});return(0,i.HL)(t),n.json()}catch(e){throw(0,i.i8)(t,e),console.error("".concat(t," error:"),e),e}},y=async(e,t,n)=>{let r="addArticleSectionMediaItemMutation";if(n)try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/section/add/media_item/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:n,media_item:t}),headers:{"Content-Type":"application/json"},numRetries:1}),o=await a.json();return(0,i.HL)(r),o}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},h=async(e,t,n)=>{let r="removeWidgetFromEntryMutation";if(n)try{let a=await (0,i.$e)({urlPath:"rest/thread/entry/remove_widget",timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({entry_uuid:e,read_write_token:n,url:t}),headers:{"Content-Type":"application/json"},numRetries:1}),o=await a.json();return(0,i.HL)(r),o}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},g=async(e,t,n)=>{let r="toggleEmphasizeSources";try{let a=await (0,i.FX)({urlPath:"p/api/v1/article/emphasize_sources/".concat(e),timeoutMs:(0,i.vX)(),method:"PUT",body:JSON.stringify({read_write_token:t,value:n}),headers:{"Content-Type":"application/json"},numRetries:1}),o=await a.json();return(0,i.HL)(r),o}catch(e){throw(0,i.i8)(r,e),console.error("".concat(r," error:"),e),e}},p=async e=>{let t="disconnectConnector:".concat(e);try{let n=await (0,i.$e)({urlPath:"rest/connectors/".concat(e,"/disconnect"),method:"GET",headers:{"Content-Type":"application/json"},timeoutMs:(0,i.vX)({productionMs:500}),numRetries:1}),r=await n.json();return(0,i.HL)(t),r}catch(e){return console.log("Error in ".concat(t,":"),e),(0,i.i8)(t,e),null}}},91579:function(e,t,n){n.d(t,{$:function(){return o}});var i=n(53854),r=n(37462),a=n.n(r);n(20981);let o=e=>{let{size:t=16,className:n,...r}=e;return(0,i.jsx)("div",{className:a()("aspect-square shrink-0 animate-spin rounded-full p-[2px]",n),style:{width:t,backgroundImage:"conic-gradient(from 270deg, transparent 0%, currentColor 99%)",mask:"radial-gradient(transparent 0%, transparent ".concat(t/2-2,"px, black ").concat(t/2-2,"px, black) center center")},...r})}}}]);